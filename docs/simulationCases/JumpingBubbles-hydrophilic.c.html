<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <!-- 
    IMPORTANT: DO NOT place empty anchor tags <a></a> in this template!
    They cause JavaScript syntax errors when they appear inside script blocks.
  -->
  <!-- Eliminate FOUC (Flash of Unstyled Content) and FOUT (Flash of Incorrect Theme) -->
  <script>
    (function() {
  try {
    // Apply the theme as quickly as possible to avoid flash
    let saved;
    try {
      saved = localStorage.getItem('theme');
    } catch (storageError) {
      // Handle localStorage access errors (private browsing, cookies disabled)
      console.warn('Unable to access localStorage:', storageError);
    }

    let prefersDark = false;
    try {
      prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    } catch (mediaError) {
      // Handle matchMedia access errors (unsupported browsers)
      console.warn('Unable to check media query:', mediaError);
    }

    const theme = saved ? saved : (prefersDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', theme);
    // Add theme class for CSS targeting
    document.documentElement.classList.add(theme + '-theme');
    // Mark when theme is set for CSS transitions
    document.documentElement.classList.add('theme-set');
  } catch (error) {
    // Fallback for any other unexpected errors
    console.warn('Theme initialization failed:', error);
    // Apply default theme as fallback
    try {
      document.documentElement.setAttribute('data-theme', 'light');
      document.documentElement.classList.add('light-theme');
      document.documentElement.classList.add('theme-set');
    } catch (fallbackError) {
      // Silent catch for extreme cases
      console.error('Critical theme fallback failed:', fallbackError);
    }
  }
})();
  </script>


  <!-- No-JS fallback for theme and critical theming styles -->
  <style>
    /* Default light theme variables */
    :root {
      /* Base colors */
      --color-background: #fff;
      --color-text: #333;
      --color-primary: #0066cc;
      --color-secondary: #036;
      --color-accent: #0099ff;

      /* UI elements */
      --color-header-bg: #f5f5f5;
      --color-footer-bg: #2d2e33;
      --color-border: #e0e0e0;
      --color-input-bg: #f9f9f9;

      /* Component colors */
      --color-preloader-bg: #ffffff;
      --color-loader: #0066cc;
      --color-card-bg: #ffffff;
      --color-code-bg: #f5f5f5;
    }

    /* Dark theme variables applied via media query when JS is disabled */
    @media (prefers-color-scheme: dark) {
      :root:not(.theme-set) {
        /* Base colors - dark mode */
        --color-background: #1a1a1a;
        --color-text: #f5f5f5;
        --color-primary: #4d9fff;
        --color-secondary: #88ccff;
        --color-accent: #00bfff;

        /* UI elements - dark mode */
        --color-header-bg: #121212;
        --color-footer-bg: #121212;
        --color-border: #333;
        --color-input-bg: #2d2d2d;

        /* Component colors - dark mode */
        --color-preloader-bg: #1a1a1a;
        --color-loader: #4d9fff;
        --color-card-bg: #222;
        --color-code-bg: #2d2d2d;
      }
    }

    /* When JS sets the theme explicitly via data attribute */
    [data-theme="dark"] {
      /* Base colors - dark mode */
      --color-background: #1a1a1a;
      --color-text: #f5f5f5;
      --color-primary: #4d9fff;
      --color-secondary: #88ccff;
      --color-accent: #00bfff;

      /* UI elements - dark mode */
      --color-header-bg: #121212;
      --color-footer-bg: #121212;
      --color-border: #333;
      --color-input-bg: #2d2d2d;

      /* Component colors - dark mode */
      --color-preloader-bg: #1a1a1a;
      --color-loader: #4d9fff;
      --color-card-bg: #222;
      --color-code-bg: #2d2d2d;
    }

    /* Prevent transition flashes during initial load */
    html:not(.transitions-enabled) * {
      transition: none !important;
    }

    /* Apply theme to preloader and early elements */
    #preloader {
      background-color: var(--color-preloader-bg);
      color: var(--color-text);
    }

    #loader {
      border-color: var(--color-loader);
      border-top-color: transparent;
    }

    /* Noscript warning */
    .noscript-warning {
      background-color: var(--color-primary);
      color: white;
      text-align: center;
      padding: 10px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    /* Theme indicator for no-JS */
    .theme-indicator {
      padding: 5px 10px;
      border-radius: 4px;
      background-color: var(--color-input-bg);
      color: var(--color-text);
      text-align: center;
    }

    /* Hide JS-only elements when no JS */
    .no-js .js-only {
      display: none !important;
    }

    /* Show no-JS alternatives */
    .js .no-js-only {
      display: none !important;
    }
  </style>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="base-url" content="..">
  <title>simulationCases/JumpingBubbles-hydrophilic.c | Jumping Bubbles</title>

  <!-- Critical CSS for fastest paint -->
  <style>
      .s-intro__title {
          visibility: visible;
          font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
      .s-header {
          visibility: visible;
      }

      /* Ensure theme toggle properly styled immediately */
      .theme-toggle {
          background-color: var(--color-background);
          color: var(--color-text);
      }

      /* Control SVG visibility based on theme */
      [data-theme="dark"] .theme-toggle-icon.sun,
      :root:not([data-theme="dark"]) .theme-toggle-icon.moon {
          display: block;
      }

      [data-theme="dark"] .theme-toggle-icon.moon,
      :root:not([data-theme="dark"]) .theme-toggle-icon.sun {
          display: none;
      }
  </style>

  <!-- Critical Meta Tags -->
  <meta name="description" content="This code simulates the coalescence and subsequent jumping of two bubbles sitting on a hydrophilic substrate using the Basilisk C framework. The simulation e...">
  <meta name="author" content="CoMPhy Lab">
  <meta name="robots" content="index, follow">
  <meta name="keywords" content="distance.h, from, grid/octree.h, hydrophilic, jumpingbubbles, navier-stokes/centered.h, navier-stokes/conserving.h, sets, tension.h, two-phase.h">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-title" content="CoMPhy Lab">

  <!-- Preload critical resources -->
  <link rel="preload" href="../assets/js/main.js" as="script">
  <link rel="preload" href="../assets/css/fontello/css/fontello.css" as="style">
  <link rel="preload" href="../assets/css/academicons-1.7.0/css/academicons.min.css" as="style">

  <!-- Base stylesheets -->
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="stylesheet" href="../assets/css/custom_styles.css">
  <link rel="stylesheet" href="../assets/css/command-palette.css">
  <link rel="stylesheet" href="../assets/css/fontello/css/fontello.css">
  <link rel="stylesheet" href="../assets/css/academicons-1.7.0/css/academicons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">

  <!-- Font optimization -->
  <style>
      @font-face {
          font-display: swap;
          font-family: 'System Font';
          src: local('system-ui');
      }
  </style>

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="96x96" href="../assets/favicon/favicon-96x96.png">
  <link rel="icon" type="image/svg+xml" href="../assets/favicon/favicon.svg">
  <link rel="shortcut icon" href="../assets/favicon/favicon.ico">
  <link rel="manifest" href="../assets/favicon/site.webmanifest">

  <!-- Scripts with proper loading attributes -->
  <script src="../assets/js/jquery.min.js"></script>
  <script src="../assets/js/jquery-ui.packed.js"></script>
  <script src="../assets/js/plots.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
  <!-- Config script must load before other scripts -->
  <script src="../assets/js/config.js"></script>
  <script defer src="../assets/js/html-sanitizer.js"></script>
  <script defer src="../assets/js/search-helper.js"></script>
  <script defer src="../assets/js/command-palette.js"></script>
  <script defer src="../assets/js/command-data.js"></script>
  <script defer src="../assets/js/main.js"></script>
  <script defer src="../assets/js/theme-toggle.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>

  <!-- Optimize page load performance -->
  <script>
    // Preconnect to critical domains
    const preconnectDomains = [
      'https://cdnjs.cloudflare.com',
      'https://cdn.jsdelivr.net'
    ];

    preconnectDomains.forEach(domain => {
      const link = document.createElement('link');
      link.rel = 'preconnect';
      link.href = domain;
      link.crossOrigin = 'anonymous';
      document.head.appendChild(link);

      // Also add DNS prefetch as fallback
      const dnsLink = document.createElement('link');
      dnsLink.rel = 'dns-prefetch';
      dnsLink.href = domain;
      document.head.appendChild(dnsLink);
    });

    // Detect when document is fully loaded to remove preloader
    window.addEventListener('load', function() {
      const preloader = document.getElementById('preloader');
      if (preloader) {
        preloader.style.opacity = '0';
        setTimeout(() => {
          preloader.style.display = 'none';
        }, 300); // Match transition duration
      }
    });
  </script>

  <script>
      // Load Font Awesome with proper environment detection and fallbacks
      function loadStylesheet(href) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = href;
        link.crossOrigin = 'anonymous';
        link.onerror = (e) => {
          console.error(`Failed to load stylesheet: `, e);
          console.log('Trying alternative Font Awesome source...');
        };
        document.head.appendChild(link);
        return link;
      }

      // Check if we're on localhost
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        // Use hardcoded version numbers for reliable loading

        // Load Font Awesome using multiple CDNs to maximize reliability for local development
        loadStylesheet('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css');
        // Backup CDN if the first one fails
        loadStylesheet('https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css');
        // Final local fallback - ensures it will work on any localhost environment
        loadStylesheet('https://use.fontawesome.com/releases/v6.7.2/css/all.css');
      } else {
        // Use Kit for production with defer
        var script = document.createElement('script');
        script.src = 'https://kit.fontawesome.com/b1cfd9ca75.js';
        script.crossOrigin = 'anonymous';
        script.defer = true;
        document.head.appendChild(script);
      }
    </script>

  <script>
      // Mark page as JS-enabled and manage transitions
      document.documentElement.classList.remove('no-js');
      document.documentElement.classList.add('js');

      // Allow CSS transitions after initial load to prevent transition flashes
      window.addEventListener('DOMContentLoaded', () => {
          setTimeout(() => {
              document.documentElement.classList.add('transitions-enabled');
          }, 100); // Short delay to ensure DOM is ready
      });
  </script>
</head>
<body id="top">
<script>window.repoName = "JumpingBubbles";</script>


    <!-- Preloader with theme variables applied -->
    <div id="preloader">
        <div id="loader"></div>
    </div>

    <noscript>
        <div class="noscript-warning">
            <p>This site works best with JavaScript enabled. Some features may be limited.</p>
        </div>
    </noscript>

    <div id="page" class="s-pagewrap">
        <header class="s-header">
            <div class="s-header__logo">
                <a class="logo" href="/">
                    <img src="../assets/logos/CoMPhy-Lab-no-name.png" alt="CoMPhy Lab">
                </a>
                <a class="documentation-button" href="/JumpingBubbles">
                    <i class="fa-solid fa-book-open"></i>
                    <span>JumpingBubbles</span>
                </a>
            </div>
            <a class="s-header__menu-toggle" href="#0">
                <span class="s-header__menu-text">Menu</span>
                <span class="s-header__menu-icon"></span>
            </a>
            <nav class="s-header__nav">
                <a href="#0" class="s-header__nav-close-btn"><span>Close</span></a>
                <ul class="s-header__nav-list">
                    <li style="background: none;">
                        <!-- JS theme toggle -->
                        <div class="theme-toggle js-only" id="theme-toggle" aria-label="Toggle dark/light theme">
                            <svg class="theme-toggle-icon moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                            <svg class="theme-toggle-icon sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="5"></circle>
                                <line x1="12" y1="1" x2="12" y2="3"></line>
                                <line x1="12" y1="21" x2="12" y2="23"></line>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                <line x1="1" y1="12" x2="3" y2="12"></line>
                                <line x1="21" y1="12" x2="23" y2="12"></line>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                            </svg>
                        </div>
                    </li>
                    <li style="background: none;"><a href="https://scholar.google.com/citations?user=tHb_qZoAAAAJ&hl=en" style="background: none; padding: 0;" aria-label="Google Scholar Profile"><i class="ai ai-google-scholar" style="font-size: 1.75em;"></i></a></li>
                    <li style="background: none;"><a href="https://github.com/comphy-lab" style="background: none; padding: 0;" aria-label="GitHub Organization"><i class="fa-brands fa-github" style="font-size: 1.75em"></i></a></li>
                    <li><a href="https://comphy-lab.org/#about" class="smoothscroll">About</a></li>
                    <li><a href="https://comphy-lab.org/team/">Team</a></li>
                    <li><a href="https://comphy-lab.org/research">Research</a></li>
                    <li><a href="https://comphy-lab.org/teaching">Teaching</a></li>
                    <li><a href="https://comphy-lab.org/join">Join Us</a></li>
                    <li><a href="https://blogs.comphy-lab.org/">Blog</a></li>
                    <li style="background: none;"><a href="https://bsky.app/profile/comphy-lab.org" style="background: none; padding: 0;" aria-label="Bluesky Profile"><i class="fa-brands fa-bluesky" style="font-size: 1.75em; color: #0085ff;"></i></a></li>
                    <!-- Command Palette Button (Styled like search) -->
                    <li class="command-palette-button">
                        <div class="command-wrapper">
                            <button class="command-k-style-btn" id="command-palette-btn" aria-label="Open command palette">
                                <span class="default-theme-text">ctrl K</span>
                                <span class="mac-theme-text">⌘ K</span>
                                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                            </button>
                        </div>
                    </li>
                </ul>
            </nav>
        </header>

        <!-- Main content -->
        <main class="content">

            <div class="page-content">

                                <h1 class="page-title">simulationCases/JumpingBubbles-hydrophilic.c</h1>


                                <div class="raw-file-button-container">
                    <a href="https://github.com/comphy-lab/JumpingBubbles/raw/main/simulationCases/JumpingBubbles-hydrophilic.c" class="raw-file-button" target="_blank" rel="noopener noreferrer">
                        <i class="fa-brands fa-github"></i> See raw file
                    </a>
                </div>

                <h1 id="jumping-bubbles-simulation">Jumping Bubbles
                Simulation</h1>
                <h2 id="overview">Overview</h2>
                <p>This code simulates the coalescence and subsequent
                jumping of two bubbles sitting on a hydrophilic
                substrate using the Basilisk C framework. The simulation
                employs an adaptive octree grid for spatial
                discretization and models two-phase flow with surface
                tension effects.</p>
                <h2 id="physics-description">Physics Description</h2>
                <p>The simulation captures the dynamics of bubble
                coalescence-induced jumping, a phenomenon where two
                bubbles merge and the resulting bubble jumps away from
                the substrate due to the conversion of surface energy
                into kinetic energy. The Volume-of-Fluid (VOF) method
                tracks the gas-liquid interface evolution throughout the
                process.</p>
                <h2 id="key-features">Key Features</h2>
                <ul>
                <li>Adaptive mesh refinement based on interface location
                and flow gradients</li>
                <li>Two-phase flow modeling with large density and
                viscosity contrasts</li>
                <li>Surface tension effects via the Continuum Surface
                Force (CSF) method</li>
                <li>STL file input for complex initial bubble
                geometries</li>
                </ul>
                <h2 id="simulation-parameters">Simulation
                Parameters</h2>
                <h3 id="dimensionless-numbers">Dimensionless
                Numbers</h3>
                <ul>
                <li><code>Oh</code>: Ohnesorge number - ratio of viscous
                to inertial-capillary forces
                <ul>
                <li>Controls the damping of interface oscillations</li>
                <li>Default: 0.01</li>
                </ul></li>
                </ul>
                <h3 id="grid-parameters">Grid Parameters</h3>
                <ul>
                <li><code>MAXlevel</code>: Maximum refinement level
                <ul>
                <li>Determines the finest grid resolution (2^MAXlevel
                cells)</li>
                <li>Default: 9</li>
                </ul></li>
                <li><code>MINlevel</code>: Minimum refinement level
                <ul>
                <li>Controls the coarsest grid resolution</li>
                <li>Fixed at: 2</li>
                </ul></li>
                </ul>
                <h3 id="temporal-parameters">Temporal Parameters</h3>
                <ul>
                <li><code>tmax</code>: Maximum simulation time
                <ul>
                <li>Default: 1e-2 (MPI disabled) or 2.0 (MPI
                enabled)</li>
                </ul></li>
                <li><code>tsnap</code>: Time interval between solution
                snapshots
                <ul>
                <li>Fixed at: 1e-2</li>
                </ul></li>
                <li><code>tsnap2</code>: Time interval for log file
                outputs
                <ul>
                <li>Fixed at: 1e-4</li>
                </ul></li>
                </ul>
                <h3 id="physical-parameters">Physical Parameters</h3>
                <ul>
                <li><code>Ldomain</code>: Length of the cubic simulation
                domain
                <ul>
                <li>Fixed at: 4</li>
                </ul></li>
                <li><code>Rho21</code>: Density ratio (gas/liquid)
                <ul>
                <li>Fixed at: 1e-3</li>
                </ul></li>
                <li><code>Mu21</code>: Viscosity ratio (gas/liquid)
                <ul>
                <li>Fixed at: 1e-3</li>
                </ul></li>
                </ul>
                <h3 id="refinement-tolerances">Refinement
                Tolerances</h3>
                <ul>
                <li><code>fErr</code>: Interface (VOF) refinement
                tolerance
                <ul>
                <li>Fixed at: 1e-3</li>
                </ul></li>
                <li><code>KErr</code>: Curvature refinement tolerance
                <ul>
                <li>Fixed at: 1e-4</li>
                </ul></li>
                <li><code>VelErr</code>: Velocity field refinement
                tolerance
                <ul>
                <li>Fixed at: 1e-4</li>
                </ul></li>
                </ul>
                <h2 id="boundary-conditions">Boundary Conditions</h2>
                <h3 id="bottom-boundary-substrate">Bottom Boundary
                (Substrate)</h3>
                <ul>
                <li>No-slip condition: tangential and radial velocities
                set to zero</li>
                <li>Wetting condition: interface fraction f = 1 (liquid
                phase)</li>
                </ul>
                <h2 id="implementation-details">Implementation
                Details</h2>
                <h3 id="solver-configuration">Solver Configuration</h3>
                <ul>
                <li>Base solver: <code>navier-stokes/centered</code> for
                momentum conservation</li>
                <li>Two-phase model: Handles density and viscosity
                jumps</li>
                <li>Surface tension: Implemented via
                <code>tension.h</code> module</li>
                <li>Conservation: Uses
                <code>navier-stokes/conserving.h</code> for mass
                conservation</li>
                </ul>
                <h3 id="geometric-processing">Geometric Processing</h3>
                <ul>
                <li><code>distance()</code>: Computes signed distance
                from STL geometry</li>
                <li><code>fractions()</code>: Constructs VOF field from
                distance function</li>
                </ul>
                <h2 id="compilation-and-execution">Compilation and
                Execution</h2>
                <h3 id="example-compilation">Example Compilation</h3>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qcc</span> <span class="at">-O2</span> <span class="at">-Wall</span> <span class="at">-disable-dimensions</span> <span class="at">-fopenmp</span> JumpingBubbles.c <span class="dt">\</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">-o</span> JumpingBubbles <span class="at">-lm</span></span></code></pre></div></div>
                <h3 id="execution">Execution</h3>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./JumpingBubbles</span></span></code></pre></div></div>
                <h2 id="output-files">Output Files</h2>
                <ul>
                <li><code>dumpFile</code>: Restart file for continuing
                simulations</li>
                <li><code>intermediate/snapshot-*.dump</code>: Solution
                snapshots at regular intervals</li>
                <li><code>log</code>: Kinetic energy evolution data</li>
                </ul>
                <h2 id="author-information">Author Information</h2>
                <ul>
                <li>Author: Vatsal</li>
                <li>Version: 1.0</li>
                <li>Date: January 4, 2025</li>
                </ul>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><a href="http://basilisk.fr/src/grid/octree.h" title="Link to Basilisk source for grid/octree.h"><span class="im">"grid/octree.h"</span></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><a href="http://basilisk.fr/src/navier-stokes/centered.h" title="Link to Basilisk source for navier-stokes/centered.h"><span class="im">"navier-stokes/centered.h"</span></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define FILTERED </span><span class="dv">1</span><span class="pp"></span><span class="dv">105</span><span class="pp"></span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><a href="http://basilisk.fr/src/two-phase.h" title="Link to Basilisk source for two-phase.h"><span class="im">"two-phase.h"</span></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><a href="http://basilisk.fr/src/navier-stokes/conserving.h" title="Link to Basilisk source for navier-stokes/conserving.h"><span class="im">"navier-stokes/conserving.h"</span></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><a href="http://basilisk.fr/src/tension.h" title="Link to Basilisk source for tension.h"><span class="im">"tension.h"</span></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#if !_MPI</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><a href="http://basilisk.fr/src/distance.h" title="Link to Basilisk source for distance.h"><span class="im">"distance.h"</span></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MINlevel </span><span class="dv">2</span><span class="pp"></span><span class="dv">114</span><span class="pp"></span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#define tsnap </span><span class="op">(</span><span class="fl">1e-2</span><span class="op">)</span><span class="pp"></span><span class="dv">115</span><span class="pp"></span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#define tsnap2 </span><span class="op">(</span><span class="fl">1e-4</span><span class="op">)</span><span class="pp"></span><span class="dv">116</span><span class="pp"></span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#define fErr </span><span class="op">(</span><span class="fl">1e-3</span><span class="op">)</span><span class="pp"></span><span class="dv">117</span><span class="pp"></span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#define KErr </span><span class="op">(</span><span class="fl">1e-4</span><span class="op">)</span><span class="pp"></span><span class="dv">118</span><span class="pp"></span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#define VelErr </span><span class="op">(</span><span class="fl">1e-4</span><span class="op">)</span><span class="pp"></span><span class="dv">119</span><span class="pp"></span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="pp">#define Mu21 </span><span class="op">(</span><span class="fl">1.00e-3</span><span class="op">)</span><span class="pp"></span><span class="dv">120</span><span class="pp"></span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="pp">#define Rho21 </span><span class="op">(</span><span class="fl">1.00e-3</span><span class="op">)</span><span class="pp"></span><span class="dv">121</span><span class="pp"></span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="pp">#define Ldomain </span><span class="dv">4</span><span class="pp"></span><span class="dv">122</span><span class="pp"></span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Boundary conditions</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>u<span class="op">.</span>t<span class="op">[</span>bottom<span class="op">]</span> <span class="op">=</span> dirichlet<span class="op">(</span><span class="fl">0.</span><span class="op">);</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>u<span class="op">.</span>r<span class="op">[</span>bottom<span class="op">]</span> <span class="op">=</span> dirichlet<span class="op">(</span><span class="fl">0.</span><span class="op">);</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>uf<span class="op">.</span>t<span class="op">[</span>bottom<span class="op">]</span> <span class="op">=</span> dirichlet<span class="op">(</span><span class="fl">0.</span><span class="op">);</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>uf<span class="op">.</span>r<span class="op">[</span>bottom<span class="op">]</span> <span class="op">=</span> dirichlet<span class="op">(</span><span class="fl">0.</span><span class="op">);</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>f<span class="op">[</span>bottom<span class="op">]</span> <span class="op">=</span> dirichlet<span class="op">(</span><span class="fl">1.</span><span class="op">);</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> tmax<span class="op">,</span> Oh<span class="op">;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> MAXlevel<span class="op">;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> nameOut<span class="op">[</span><span class="dv">80</span><span class="op">],</span> dumpFile<span class="op">[</span><span class="dv">80</span><span class="op">];</span></span></code></pre></div></div>
                <h2 id="main-function">Main Function</h2>
                <p>Initializes simulation parameters and executes the
                run. The function sets different maximum times based on
                whether MPI is enabled, configures the Ohnesorge number
                and grid parameters, and initializes the computational
                domain.</p>
                <h3 id="key-operations">Key Operations</h3>
                <ul>
                <li>Sets simulation duration based on parallelization
                mode</li>
                <li>Configures physical parameters (Oh number,
                refinement levels)</li>
                <li>Initializes the grid with minimum refinement
                level</li>
                <li>Sets fluid properties based on dimensionless
                parameters</li>
                <li>Creates output directory structure</li>
                </ul>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#if !_MPI</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  tmax <span class="op">=</span> <span class="fl">1e-2</span><span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  tmax <span class="op">=</span> <span class="fl">2e0</span><span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  Oh <span class="op">=</span> <span class="fl">0.01</span><span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  MAXlevel <span class="op">=</span> <span class="dv">9</span><span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  init_grid<span class="op">(</span><span class="dv">1</span> <span class="op">&lt;&lt;</span> MINlevel<span class="op">);</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  L0 <span class="op">=</span> Ldomain<span class="op">;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;tmax = </span><span class="sc">%g</span><span class="st">. Oh = </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span> tmax<span class="op">,</span> Oh<span class="op">);</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  rho1 <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  mu1 <span class="op">=</span> Oh<span class="op">;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  rho2 <span class="op">=</span> Rho21<span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  mu2 <span class="op">=</span> Mu21 <span class="op">*</span> Oh<span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  f<span class="op">.</span>sigma <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> comm<span class="op">[</span><span class="dv">80</span><span class="op">];</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  sprintf<span class="op">(</span>comm<span class="op">,</span> <span class="st">&quot;mkdir -p intermediate&quot;</span><span class="op">);</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  system<span class="op">(</span>comm<span class="op">);</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  sprintf<span class="op">(</span>dumpFile<span class="op">,</span> <span class="st">&quot;restartFile&quot;</span><span class="op">);</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  run<span class="op">();</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></div>
                <h2 id="initialization-event">Initialization Event</h2>
                <p>Sets up the initial bubble configuration either by
                restoring from a previous simulation or by reading an
                STL file containing the bubble geometry.</p>
                <h3 id="workflow">Workflow</h3>
                <ul>
                <li>Attempts to restore from a dump file if
                available</li>
                <li>If restoration fails, reads bubble geometry from STL
                file</li>
                <li>Computes signed distance function from STL
                geometry</li>
                <li>Performs initial adaptive refinement based on
                distance field</li>
                <li>Converts distance function to VOF field using
                fractions()</li>
                <li>Initializes velocity field to zero</li>
                </ul>
                <h3 id="stl-processing-details">STL Processing
                Details</h3>
                <ul>
                <li>Reads “InitialCondition.stl” file</li>
                <li>Computes bounding box of geometry</li>
                <li>Centers domain around bubble configuration</li>
                <li>Applies small vertical offset (-0.025) for substrate
                contact</li>
                </ul>
                <h3 id="error-handling">Error Handling</h3>
                <ul>
                <li>Reports if dump file restoration fails</li>
                <li>Exits with error if STL file is not found</li>
                <li>Logs bounding box coordinates for verification</li>
                </ul>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>event init<span class="op">(</span>t <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#if _MPI</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!</span>restore<span class="op">(</span>file <span class="op">=</span> dumpFile<span class="op">))</span> <span class="op">{</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;Cannot restored from a dump file!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!</span>restore<span class="op">(</span>file <span class="op">=</span> dumpFile<span class="op">))</span> <span class="op">{</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> filename<span class="op">[</span><span class="dv">60</span><span class="op">];</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    sprintf<span class="op">(</span>filename<span class="op">,</span> <span class="st">&quot;InitialCondition.stl&quot;</span><span class="op">);</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span> fp <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">&quot;r&quot;</span><span class="op">);</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fp <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;There is no file named </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> filename<span class="op">);</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    coord <span class="op">*</span> p <span class="op">=</span> input_stl<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    coord min<span class="op">,</span> max<span class="op">;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    bounding_box<span class="op">(</span>p<span class="op">,</span> <span class="op">&amp;</span>min<span class="op">,</span> <span class="op">&amp;</span>max<span class="op">);</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;xmin </span><span class="sc">%g</span><span class="st"> xmax </span><span class="sc">%g\n</span><span class="st">ymin </span><span class="sc">%g</span><span class="st"> ymax </span><span class="sc">%g\n</span><span class="st">zmin </span><span class="sc">%g</span><span class="st"> zmax </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>            min<span class="op">.</span>x<span class="op">,</span> max<span class="op">.</span>x<span class="op">,</span> min<span class="op">.</span>y<span class="op">,</span> max<span class="op">.</span>y<span class="op">,</span> min<span class="op">.</span>z<span class="op">,</span> max<span class="op">.</span>z<span class="op">);</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;x0 = </span><span class="sc">%g</span><span class="st">, y0 = </span><span class="sc">%g</span><span class="st">, z0 = </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="op">,</span> <span class="op">(</span>min<span class="op">.</span>z <span class="op">+</span> max<span class="op">.</span>z<span class="op">)</span> <span class="op">/</span> <span class="fl">2.</span><span class="op">);</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    origin<span class="op">(</span><span class="fl">0.</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span> <span class="op">(</span>min<span class="op">.</span>z <span class="op">+</span> max<span class="op">.</span>z<span class="op">)</span> <span class="op">/</span> <span class="fl">2.</span><span class="op">);</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    scalar d<span class="op">[];</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    distance<span class="op">(</span>d<span class="op">,</span> p<span class="op">);</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>adapt_wavelet<span class="op">((</span>scalar <span class="op">*){</span>f<span class="op">,</span> d<span class="op">},</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                         <span class="op">(</span><span class="dt">double</span><span class="op">[]){</span><span class="fl">1e-6</span><span class="op">,</span> <span class="fl">1e-6</span> <span class="op">*</span> L0<span class="op">},</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                         MAXlevel<span class="op">).</span>nf<span class="op">);</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    vertex scalar phi<span class="op">[];</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    foreach_vertex<span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>      phi<span class="op">[]</span> <span class="op">=</span> <span class="op">-(</span>d<span class="op">[]</span> <span class="op">+</span> d<span class="op">[-</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> d<span class="op">[</span><span class="dv">0</span><span class="op">,-</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> d<span class="op">[-</span><span class="dv">1</span><span class="op">,-</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                d<span class="op">[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,-</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> d<span class="op">[-</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,-</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> d<span class="op">[</span><span class="dv">0</span><span class="op">,-</span><span class="dv">1</span><span class="op">,-</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> d<span class="op">[-</span><span class="dv">1</span><span class="op">,-</span><span class="dv">1</span><span class="op">,-</span><span class="dv">1</span><span class="op">])</span> <span class="op">/</span> <span class="fl">8.</span><span class="op">;</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    fractions<span class="op">(</span>phi<span class="op">,</span> f<span class="op">);</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    foreach<span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>      foreach_dimension<span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        u<span class="op">.</span>x<span class="op">[]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    dump<span class="op">(</span>file <span class="op">=</span> <span class="st">&quot;dumpInit&quot;</span><span class="op">);</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;Done with initial condition!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></div>
                <h2 id="adaptive-refinement-event">Adaptive Refinement
                Event</h2>
                <p>Performs dynamic mesh refinement at each timestep
                based on solution gradients. This ensures computational
                resources are concentrated in regions of high activity
                while maintaining accuracy.</p>
                <h3 id="refinement-criteria">Refinement Criteria</h3>
                <ul>
                <li>Interface location (VOF field f)</li>
                <li>Interface curvature (computed from VOF field)</li>
                <li>Velocity components (all three directions)</li>
                </ul>
                <h3 id="implementation">Implementation</h3>
                <ul>
                <li>Computes local curvature using the curvature()
                function</li>
                <li>Applies wavelet-based error estimation</li>
                <li>Refines/coarsens cells based on error
                tolerances</li>
                <li>Maintains refinement between MINlevel and
                MAXlevel</li>
                </ul>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>event adapt<span class="op">(</span>i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  scalar KAPPA<span class="op">[];</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  curvature<span class="op">(</span>f<span class="op">,</span> KAPPA<span class="op">);</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  adapt_wavelet<span class="op">((</span>scalar <span class="op">*){</span>f<span class="op">,</span> KAPPA<span class="op">,</span> u<span class="op">.</span>x<span class="op">,</span> u<span class="op">.</span>y<span class="op">,</span> u<span class="op">.</span>z<span class="op">},</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                <span class="op">(</span><span class="dt">double</span><span class="op">[]){</span>fErr<span class="op">,</span> KErr<span class="op">,</span> VelErr<span class="op">,</span> VelErr<span class="op">,</span> VelErr<span class="op">},</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                MAXlevel<span class="op">,</span> MINlevel<span class="op">);</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></div>
                <h2 id="file-output-event">File Output Event</h2>
                <p>Writes solution snapshots at regular intervals for
                post-processing and visualization. Creates both restart
                files and timestamped snapshots.</p>
                <h3 id="output-schedule">Output Schedule</h3>
                <ul>
                <li>Triggers at t = 0 and every tsnap interval</li>
                <li>Continues until tmax + tsnap</li>
                </ul>
                <h3 id="file-structure">File Structure</h3>
                <ul>
                <li>Overwrites main restart file at each output</li>
                <li>Creates timestamped snapshots in intermediate/
                directory</li>
                <li>Uses 5.4f format for time in filenames</li>
                </ul>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>event writingFiles<span class="op">(</span>t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">+=</span> tsnap<span class="op">;</span> t <span class="op">&lt;=</span> tmax <span class="op">+</span> tsnap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  dump<span class="op">(</span>file <span class="op">=</span> dumpFile<span class="op">);</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> nameOut<span class="op">[</span><span class="dv">80</span><span class="op">];</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  sprintf<span class="op">(</span>nameOut<span class="op">,</span> <span class="st">&quot;intermediate/snapshot-</span><span class="sc">%5.4f</span><span class="st">&quot;</span><span class="op">,</span> t<span class="op">);</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  dump<span class="op">(</span>file <span class="op">=</span> nameOut<span class="op">);</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></div>
                <h2 id="logging-event">Logging Event</h2>
                <p>Records integral quantities at high frequency for
                quantitative analysis. Specifically tracks the kinetic
                energy of the gas phase to monitor bubble dynamics.</p>
                <h3 id="computed-quantities">Computed Quantities</h3>
                <ul>
                <li>Kinetic energy of gas phase: KE = 0.5 * ρ * (u² + v²
                + w²) * (1-f) * ΔV</li>
                <li>Uses clamp() to ensure clean phase separation</li>
                </ul>
                <h3 id="output-format">Output Format</h3>
                <ul>
                <li>Headers: i (iteration), dt (timestep), t (time), ke
                (kinetic energy)</li>
                <li>Writes to both stderr and “log” file</li>
                <li>Appends to existing log file after initial
                write</li>
                </ul>
                <h3 id="parallel-considerations">Parallel
                Considerations</h3>
                <ul>
                <li>Uses reduction operation for parallel summation</li>
                <li>Only process 0 performs file I/O</li>
                </ul>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>event logWriting<span class="op">(</span>t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">+=</span> tsnap2<span class="op">;</span> t <span class="op">&lt;=</span> tmax <span class="op">+</span> tsnap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> ke <span class="op">=</span> <span class="fl">0.</span><span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  foreach<span class="op">(</span>reduction<span class="op">(+:</span>ke<span class="op">))</span> <span class="op">{</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    ke <span class="op">+=</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="op">(</span>sq<span class="op">(</span>u<span class="op">.</span>x<span class="op">[])</span> <span class="op">+</span> sq<span class="op">(</span>u<span class="op">.</span>y<span class="op">[])</span> <span class="op">+</span> sq<span class="op">(</span>u<span class="op">.</span>z<span class="op">[]))</span> <span class="op">*</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>          clamp<span class="op">(</span><span class="fl">1.</span> <span class="op">-</span> f<span class="op">[],</span> <span class="fl">0.</span><span class="op">,</span> <span class="fl">1.</span><span class="op">)</span> <span class="op">*</span> cube<span class="op">(</span>Delta<span class="op">);</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>pid<span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">FILE</span> <span class="op">*</span> fp<span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;i dt t ke</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">&quot;log&quot;</span><span class="op">,</span> <span class="st">&quot;w&quot;</span><span class="op">);</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">&quot;i dt t ke</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>      fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> dt<span class="op">,</span> t<span class="op">,</span> ke<span class="op">);</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>      fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">&quot;log&quot;</span><span class="op">,</span> <span class="st">&quot;a&quot;</span><span class="op">);</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> dt<span class="op">,</span> t<span class="op">,</span> ke<span class="op">);</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> dt<span class="op">,</span> t<span class="op">,</span> ke<span class="op">);</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></div>
            </div>
        </main>

        <footer class="site-footer">
            <div class="footer-left">
              <a href="http://basilisk.fr/sandbox/vatsal/" target="_blank" rel="noopener noreferrer">
                <img src="../assets/logos/logoBasilisk_TransparentBackground.png" alt="Basilisk C" class="footer-logo">
              </a>
              <a href="https://pof.tnw.utwente.nl/" target="_blank" rel="noopener noreferrer">
                <img src="../assets/logos/LogoPof_transparent_white.png" alt="Physics of Fluids" class="footer-logo pof-logo">
              </a>
              <a href="https://www.utwente.nl/" target="_blank" rel="noopener noreferrer">
                <img src="../assets/logos/UT_Logo_2400_Sta_White_EN.png" alt="University of Twente" class="footer-logo">
              </a>
              <a href="https://www.vatsalsanjay.com/" target="_blank" rel="noopener noreferrer">
                <img src="../assets/logos/Logo_Vatsal_v3_OutLine.png" alt="Vatsal Sanjay" class="footer-logo">
              </a>
            </div>
            <div class="footer-center">
              <p class="copyright-text">
                &copy; Copyright<br>
                CoMPhy Lab 2025
              </p>
            </div>
            <div class="footer-right">
              <a href="https://scholar.google.com/citations?user=tHb_qZoAAAAJ&hl=en" target="_blank" rel="noopener noreferrer" aria-label="Google Scholar Profile">
                <i class="ai ai-google-scholar" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://github.com/comphy-lab" target="_blank" rel="noopener noreferrer" aria-label="GitHub Organization">
                <i class="fa-brands fa-github" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://www.youtube.com/@CoMPhyLab" target="_blank" rel="noopener noreferrer" aria-label="YouTube Channel">
                <i class="fa-brands fa-youtube" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://x.com/VatsalSanjay" target="_blank" rel="noopener noreferrer" aria-label="X (Twitter) Profile">
                <i class="fa-brands fa-x-twitter" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://bsky.app/profile/comphy-lab.org" target="_blank" rel="noopener noreferrer" aria-label="Bluesky Profile">
                <i class="fa-brands fa-bluesky" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://github.com/comphy-lab/JumpingBubbles" class="edit-link" aria-label="Edit this page on GitHub">
                <i class="fa-brands fa-github"></i> Edit this page
              </a>
            </div>
          </footer>
    </div>  

    <!-- Command Palette -->
    <div id="simple-command-palette" class="simple-command-palette" style="display: none;">
        <div class="simple-command-palette-backdrop"></div>
        <div class="simple-command-palette-modal">
            <input type="text" id="command-palette-input" placeholder="Type a command..." autocomplete="off">
            <div id="command-palette-results" class="command-palette-results"></div>
            <div class="command-palette-footer">
                <span class="command-palette-footer-item"><kbd>↑</kbd> <kbd>↓</kbd> to navigate</span>
                <span class="command-palette-footer-item"><kbd>enter</kbd> to select</span>
                <span class="command-palette-footer-item"><kbd>esc</kbd> to close</span>
            </div>
        </div>
    </div>


<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Add copy button to each code block container
    const codeBlocks = document.querySelectorAll('.code-block-container pre');
    codeBlocks.forEach(function(codeBlock, index) {
        // Create button element
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        button.setAttribute('aria-label', 'Copy code to clipboard');
        button.setAttribute('data-copy-state', 'copy');
        
        // Get the code block container (parent of the pre)
        const container = codeBlock.parentNode;
        
        // Add the button to the container
        container.appendChild(button);
        
        // Set up click event
        button.addEventListener('click', async function() {
            const codeText = codeBlock.textContent;
            
            try {
                // Try to use the modern clipboard API first
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(codeText);
                    updateButtonState(button, 'success');
                } else {
                    // Fall back to the deprecated execCommand method
                    const textarea = document.createElement('textarea');
                    textarea.value = codeText;
                    textarea.style.position = 'fixed';  // Prevent scrolling to the bottom
                    document.body.appendChild(textarea);
                    textarea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textarea);
                    
                    if (successful) {
                        updateButtonState(button, 'success');
                    } else {
                        updateButtonState(button, 'error');
                    }
                }
            } catch (err) {
                console.error('Copy failed:', err);
                updateButtonState(button, 'error');
            }
        });
    });
    
    // Function to update button state
    function updateButtonState(button, state) {
        if (state === 'success') {
            button.textContent = 'Copied!';
            button.classList.add('copied');
        } else if (state === 'error') {
            button.textContent = 'Error!';
            button.classList.add('error');
        }
        
        // Reset button state after 2 seconds
        setTimeout(function() {
            button.textContent = 'Copy';
            button.classList.remove('copied', 'error');
        }, 2000);
    }
});
</script>
        </body>
</html>
